{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.16.0/.schema/devbox.schema.json",
  "packages": [
    "rustup@latest",
    "libiconv@latest",
    "bzip2@latest",
    "uv@latest",
    "python@3.10",
    "./flakes/libtorch"
  ],
  "env": {
    "PYO3_PYTHON": "$PWD/.venv/bin/python",
    "PYTHON_HOME": "$PWD/.venv",
    "LIBTORCH_BYPASS_VERSION_CHECK": "1"
  },
  "shell": {
    "init_hook": [
      "export LIBTORCH=$(nix build --no-link --print-out-paths ./flakes/libtorch 2>/dev/null)",
      "export LIBTORCH_INCLUDE=\"$LIBTORCH/include\"",
      "export LIBTORCH_LIB=\"$LIBTORCH/lib\"",
      "export DYLD_LIBRARY_PATH=\"$LIBTORCH/lib:$DYLD_LIBRARY_PATH\"",
      "export BZIP2_LIB=$(nix build --no-link --print-out-paths nixpkgs#bzip2.out 2>/dev/null)",
      "export RUSTFLAGS=\"-L $BZIP2_LIB/lib ${RUSTFLAGS:-}\"",
      ". $VENV_DIR/bin/activate",
      "pip install -r requirements.txt",
      "rustup default stable",
      "cargo fetch"
    ],
    "scripts": {
      "test": "cargo test -- --show-output",
      "start": "cargo run",
      "build-docs": "cargo doc"
    }
  }
}
